import { syncContent } from '../services/contentSyncService';

/**
 * "ì»¨í…ì¸  ì—…ë°ì´íŠ¸í•´ì¤˜" ëª…ë ¹ì–´ ì²˜ë¦¬ í—¬í¼
 * Claude Codeì—ì„œ ì‚¬ìš©ìž ìš”ì²­ì„ ë°›ì•˜ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
 */
export const handleContentUpdateRequest = async () => {
  try {
    console.log('ðŸŽ¯ ì»¨í…ì¸  ì—…ë°ì´íŠ¸ ìš”ì²­ ì²˜ë¦¬ ì‹œìž‘...');
    
    // 1. localStorageì—ì„œ í•„ìš”í•œ íŒŒì¼ ëª©ë¡ í™•ì¸ ë° bash ëª…ë ¹ì–´ ìƒì„±
    const result = await syncContent();
    
    if (result.commands.length === 0) {
      console.log(result.summary);
      return {
        success: false,
        message: result.summary,
        commands: []
      };
    }
    
    console.log(result.summary);
    
    // 2. ìƒì„±ëœ bash ëª…ë ¹ì–´ë“¤ ë°˜í™˜ (Claude Codeì—ì„œ ì‹¤í–‰)
    return {
      success: true,
      message: result.summary,
      commands: result.commands,
      instructions: [
        'ðŸ”„ ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤:',
        '1. íŒŒì¼ ì¡´ìž¬ í™•ì¸ ë° ì„ íƒì  ë³µì‚¬',
        '2. Git add, commit, push',
        '3. ì™„ë£Œ ì•Œë¦¼'
      ]
    };
    
  } catch (error) {
    console.error('âŒ ì»¨í…ì¸  ì—…ë°ì´íŠ¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
    return {
      success: false,
      message: `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`,
      commands: []
    };
  }
};

/**
 * ì‚¬ìš©ìžê°€ "ì»¨í…ì¸  ì—…ë°ì´íŠ¸í•´ì¤˜", "ì»¨í…ì¸  ë™ê¸°í™”í•´ì¤˜" ë“±ì˜ ëª…ë ¹ì–´ë¥¼ ìž…ë ¥í–ˆëŠ”ì§€ í™•ì¸
 */
export const isContentUpdateCommand = (userMessage: string): boolean => {
  const contentUpdateKeywords = [
    'ì»¨í…ì¸  ì—…ë°ì´íŠ¸',
    'ì»¨í…ì¸  ë™ê¸°í™”',
    'ì»¨í…ì¸  ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸',
    'ë‰´ìŠ¤ íŒŒì¼ ì—…ë°ì´íŠ¸',
    'ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸',
    'í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸',
    'íŒŒì¼ ë™ê¸°í™”'
  ];
  
  const message = userMessage.toLowerCase().replace(/\s/g, '');
  return contentUpdateKeywords.some(keyword => 
    message.includes(keyword.toLowerCase().replace(/\s/g, ''))
  );
};

/**
 * Git ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±
 */
export const generateCommitMessage = (fileCount: number): string => {
  const timestamp = new Date().toISOString().split('T')[0];
  return `Update news content files (${fileCount} files) - ${timestamp}

- Sync text and image files from contents/ to public/contents/
- Updated based on published articles in localStorage
- Auto-generated by content sync system

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>`;
};