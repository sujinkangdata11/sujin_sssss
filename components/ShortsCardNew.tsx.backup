import React from 'react';
import { YouTubeShort, Language } from '../types';

interface ShortsCardNewProps {
  short: YouTubeShort;
  language: Language;
  index: number;
}

const ShortsCardNew: React.FC<ShortsCardNewProps> = ({ short, language, index }) => {
  const [showAllTags, setShowAllTags] = React.useState(false);
  const [isExpanded, setIsExpanded] = React.useState(false);
  const [isCopied, setIsCopied] = React.useState(false);
  // ì°¸ì—¬ìœ¨ ê³„ì‚° (ì¢‹ì•„ìš”+ëŒ“ê¸€)/ì¡°íšŒìˆ˜Ã—10,000 (1ë§Œë·° ê¸°ì¤€)
  const calculateEngagementRate = (): number => {
    if (short.viewCount === 0) return 0;
    const likes = short.likeCount || 0;
    const comments = short.commentCount || 0;
    return ((likes + comments) / short.viewCount) * 10000;
  };

  const engagementRate = calculateEngagementRate();

  // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
  const formatNumber = (num: number): string => {
    if (language === 'ko') {
      if (num >= 100000000) return `${(num / 100000000).toFixed(1)}ì–µ`;
      if (num >= 10000) return `${Math.floor(num / 10000)}ë§Œ`;
      if (num >= 1000) return `${(num / 1000).toFixed(1)}ì²œ`;
      return num.toLocaleString();
    }
    return num.toLocaleString();
  };

  // í‰ê·  ì¡°íšŒìˆ˜ ê³„ì‚°
  const calculateAverageViews = (): number => {
    if (!short.channelViewCount || !short.videoCount || short.videoCount === 0) return 0;
    return Math.round(short.channelViewCount / short.videoCount);
  };

  const averageViews = calculateAverageViews();

  // YouTube ì¹´í…Œê³ ë¦¬ IDë¥¼ ì‹¤ì œ ì¹´í…Œê³ ë¦¬ëª…ìœ¼ë¡œ ë³€í™˜
  const getCategoryName = (categoryId: string | undefined): string => {
    if (!categoryId) return 'ì¸ë¬¼/ë¸”ë¡œê·¸';
    
    const categoryMap: Record<string, string> = {
      '1': 'ì˜í™”/ì• ë‹ˆë©”ì´ì…˜',
      '2': 'ìë™ì°¨/ì°¨ëŸ‰',
      '10': 'ìŒì•…',
      '15': 'ì• ì™„ë™ë¬¼/ë™ë¬¼',
      '17': 'ìŠ¤í¬ì¸ ',
      '19': 'ì—¬í–‰/ì´ë²¤íŠ¸',
      '20': 'ê²Œì„',
      '22': 'ì¸ë¬¼/ë¸”ë¡œê·¸',
      '23': 'ì½”ë¯¸ë””',
      '24': 'ì—”í„°í…Œì¸ë¨¼íŠ¸',
      '25': 'ë‰´ìŠ¤/ì •ì¹˜',
      '26': 'í•˜ìš°íˆ¬/ìŠ¤íƒ€ì¼',
      '27': 'êµìœ¡',
      '28': 'ê³¼í•™/ê¸°ìˆ ',
      '29': 'ë¹„ì˜ë¦¬/í™œë™'
    };
    
    return categoryMap[categoryId] || `ì¹´í…Œê³ ë¦¬ ${categoryId}`;
  };

  // êµ­ê°€ ì½”ë“œë¥¼ ì–¸ì–´ì— ë§ëŠ” ì´ë¦„ê³¼ ì´ëª¨ì§€ë¡œ ë³€í™˜
  const detectCountryFromTitle = (): string => {
    const title = short.title.toLowerCase();
    
    // í•œê¸€ íŒ¨í„´ ê°ì§€
    if (/[ã„±-ã…|ã…-ã…£|ê°€-í£]/.test(title)) {
      return language === 'en' ? 'South Korea ğŸ‡°ğŸ‡·' : 'í•œêµ­ ğŸ‡°ğŸ‡·';
    }
    
    // ê¸°ë³¸ê°’: ì˜ì–´ = ë¯¸êµ­
    return language === 'en' ? 'United States ğŸ‡ºğŸ‡¸' : language === 'ko' ? 'ë¯¸êµ­ ğŸ‡ºğŸ‡¸' : 'United States ğŸ‡ºğŸ‡¸';
    
    const countryMap: Record<string, { flag: string; names: Record<Language, string> }> = {
      'US': { flag: 'ğŸ‡ºğŸ‡¸', names: { en: 'United States', ko: 'ë¯¸êµ­', ja: 'ã‚¢ãƒ¡ãƒªã‚«', zh: 'ç¾å›½', hi: 'à¤¸à¤‚à¤¯à¥à¤•à¥à¤¤ à¤°à¤¾à¤œà¥à¤¯ à¤…à¤®à¥‡à¤°à¤¿à¤•à¤¾', es: 'Estados Unidos', fr: 'Ã‰tats-Unis', de: 'Vereinigte Staaten', nl: 'Verenigde Staten', pt: 'Estados Unidos', ru: 'Ğ¡Ğ¨Ğ' } },
      'KR': { flag: 'ğŸ‡°ğŸ‡·', names: { en: 'South Korea', ko: 'í•œêµ­', ja: 'éŸ“å›½', zh: 'éŸ©å›½', hi: 'à¤¦à¤•à¥à¤·à¤¿à¤£ à¤•à¥‹à¤°à¤¿à¤¯à¤¾', es: 'Corea del Sur', fr: 'CorÃ©e du Sud', de: 'SÃ¼dkorea', nl: 'Zuid-Korea', pt: 'Coreia do Sul', ru: 'Ğ®Ğ¶Ğ½Ğ°Ñ ĞšĞ¾Ñ€ĞµÑ' } },
      'JP': { flag: 'ğŸ‡¯ğŸ‡µ', names: { en: 'Japan', ko: 'ì¼ë³¸', ja: 'æ—¥æœ¬', zh: 'æ—¥æœ¬', hi: 'à¤œà¤¾à¤ªà¤¾à¤¨', es: 'JapÃ³n', fr: 'Japon', de: 'Japan', nl: 'Japan', pt: 'JapÃ£o', ru: 'Ğ¯Ğ¿Ğ¾Ğ½Ğ¸Ñ' } },
      'CN': { flag: 'ğŸ‡¨ğŸ‡³', names: { en: 'China', ko: 'ì¤‘êµ­', ja: 'ä¸­å›½', zh: 'ä¸­å›½', hi: 'à¤šà¥€à¤¨', es: 'China', fr: 'Chine', de: 'China', nl: 'China', pt: 'China', ru: 'ĞšĞ¸Ñ‚Ğ°Ğ¹' } },
      'GB': { flag: 'ğŸ‡¬ğŸ‡§', names: { en: 'United Kingdom', ko: 'ì˜êµ­', ja: 'ã‚¤ã‚®ãƒªã‚¹', zh: 'è‹±å›½', hi: 'à¤¯à¥‚à¤¨à¤¾à¤‡à¤Ÿà¥‡à¤¡ à¤•à¤¿à¤‚à¤—à¤¡à¤®', es: 'Reino Unido', fr: 'Royaume-Uni', de: 'Vereinigtes KÃ¶nigreich', nl: 'Verenigd Koninkrijk', pt: 'Reino Unido', ru: 'Ğ’ĞµĞ»Ğ¸ĞºĞ¾Ğ±Ñ€Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ' } },
      'CA': { flag: 'ğŸ‡¨ğŸ‡¦', names: { en: 'Canada', ko: 'ìºë‚˜ë‹¤', ja: 'ã‚«ãƒŠãƒ€', zh: 'åŠ æ‹¿å¤§', hi: 'à¤•à¤¨à¤¾à¤¡à¤¾', es: 'CanadÃ¡', fr: 'Canada', de: 'Kanada', nl: 'Canada', pt: 'CanadÃ¡', ru: 'ĞšĞ°Ğ½Ğ°Ğ´Ğ°' } },
      'AU': { flag: 'ğŸ‡¦ğŸ‡º', names: { en: 'Australia', ko: 'í˜¸ì£¼', ja: 'ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢', zh: 'æ¾³å¤§åˆ©äºš', hi: 'à¤‘à¤¸à¥à¤Ÿà¥à¤°à¥‡à¤²à¤¿à¤¯à¤¾', es: 'Australia', fr: 'Australie', de: 'Australien', nl: 'AustraliÃ«', pt: 'AustrÃ¡lia', ru: 'ĞĞ²ÑÑ‚Ñ€Ğ°Ğ»Ğ¸Ñ' } },
      'DE': { flag: 'ğŸ‡©ğŸ‡ª', names: { en: 'Germany', ko: 'ë…ì¼', ja: 'ãƒ‰ã‚¤ãƒ„', zh: 'å¾·å›½', hi: 'à¤œà¤°à¥à¤®à¤¨à¥€', es: 'Alemania', fr: 'Allemagne', de: 'Deutschland', nl: 'Duitsland', pt: 'Alemanha', ru: 'Ğ“ĞµÑ€Ğ¼Ğ°Ğ½Ğ¸Ñ' } },
      'FR': { flag: 'ğŸ‡«ğŸ‡·', names: { en: 'France', ko: 'í”„ë‘ìŠ¤', ja: 'ãƒ•ãƒ©ãƒ³ã‚¹', zh: 'æ³•å›½', hi: 'à¤«à¤¼à¥à¤°à¤¾à¤‚à¤¸', es: 'Francia', fr: 'France', de: 'Frankreich', nl: 'Frankrijk', pt: 'FranÃ§a', ru: 'Ğ¤Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ' } },
      'IN': { flag: 'ğŸ‡®ğŸ‡³', names: { en: 'India', ko: 'ì¸ë„', ja: 'ã‚¤ãƒ³ãƒ‰', zh: 'å°åº¦', hi: 'à¤­à¤¾à¤°à¤¤', es: 'India', fr: 'Inde', de: 'Indien', nl: 'India', pt: 'Ãndia', ru: 'Ğ˜Ğ½Ğ´Ğ¸Ñ' } }
    };
    
    const country = countryMap[countryCode.toUpperCase()];
    const countryName = country?.names[language] || country?.names.en || countryCode;
    return country ? `${countryName} ${country.flag}` : `${countryCode} ğŸŒ`;
  };

  // ê¸°ì¡´ ShortsCardì˜ timeAgo í•¨ìˆ˜ ë³µì‚¬
  const timeAgo = (dateString: string): string => {
    const date = new Date(dateString);
    const now = new Date();
    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);

    type Unit = 'year' | 'month' | 'day' | 'hour' | 'minute' | 'second';
    const units: Record<Language, Record<string, string>> = {
      en: { year: 'year', month: 'month', day: 'day', hour: 'hour', minute: 'minute', second: 'second', plural: 's', ago: 'ago' },
      ko: { year: 'ë…„', month: 'ê°œì›”', day: 'ì¼', hour: 'ì‹œê°„', minute: 'ë¶„', second: 'ì´ˆ', plural: '', ago: 'ì „' },
      ja: { year: 'å¹´', month: 'ãƒ¶æœˆ', day: 'æ—¥', hour: 'æ™‚é–“', minute: 'åˆ†', second: 'ç§’', plural: '', ago: 'å‰' },
      zh: { year: 'å¹´', month: 'ä¸ªæœˆ', day: 'å¤©', hour: 'å°æ—¶', minute: 'åˆ†é’Ÿ', second: 'ç§’', plural: '', ago: 'å‰' },
      hi: { year: 'à¤¸à¤¾à¤²', month: 'à¤®à¤¹à¥€à¤¨à¥‡', day: 'à¤¦à¤¿à¤¨', hour: 'à¤˜à¤‚à¤Ÿà¤¾', minute: 'à¤®à¤¿à¤¨à¤Ÿ', second: 'à¤¸à¥‡à¤•à¤‚à¤¡', plural: '', ago: 'à¤ªà¤¹à¤²à¥‡' },
      es: { year: 'aÃ±o', month: 'mes', day: 'dÃ­a', hour: 'hora', minute: 'minuto', second: 'segundo', plural: 's', ago: 'hace' },
      fr: { year: 'an', month: 'mois', day: 'jour', hour: 'heure', minute: 'minute', second: 'seconde', plural: 's', ago: 'il y a' },
      de: { year: 'Jahr', month: 'Monat', day: 'Tag', hour: 'Stunde', minute: 'Minute', second: 'Sekunde', plural: 'en', ago: 'vor' },
      nl: { year: 'jaar', month: 'maand', day: 'dag', hour: 'uur', minute: 'minuut', second: 'seconde', plural: 'en', ago: 'geleden' },
      pt: { year: 'ano', month: 'mÃªs', day: 'dia', hour: 'hora', minute: 'minuto', second: 'segundo', plural: 's', ago: 'atrÃ¡s' },
      ru: { year: 'Ğ³Ğ¾Ğ´', month: 'Ğ¼ĞµÑÑÑ†', day: 'Ğ´ĞµĞ½ÑŒ', hour: 'Ñ‡Ğ°Ñ', minute: 'Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ', second: 'ÑĞµĞºÑƒĞ½Ğ´Ñƒ', ago: 'Ğ½Ğ°Ğ·Ğ°Ğ´' },
    };

    const t = units[language] || units.en;

    const format = (value: number, unit: Unit) => {
      if (language === 'ru') {
        let form = '';
        if (unit === 'year') form = (value === 1) ? 'Ğ³Ğ¾Ğ´' : (value < 5 ? 'Ğ³Ğ¾Ğ´Ğ°' : 'Ğ»ĞµÑ‚');
        else if (unit === 'month') form = (value === 1) ? 'Ğ¼ĞµÑÑÑ†' : (value < 5 ? 'Ğ¼ĞµÑÑÑ†Ğ°' : 'Ğ¼ĞµÑÑÑ†ĞµĞ²');
        else if (unit === 'day') form = (value === 1) ? 'Ğ´ĞµĞ½ÑŒ' : (value < 5 ? 'Ğ´Ğ½Ñ' : 'Ğ´Ğ½ĞµĞ¹');
        else if (unit === 'hour') form = (value === 1) ? 'Ñ‡Ğ°Ñ' : (value < 5 ? 'Ñ‡Ğ°ÑĞ°' : 'Ñ‡Ğ°ÑĞ¾Ğ²');
        else if (unit === 'minute') form = (value === 1) ? 'Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°' : (value < 5 ? 'Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹' : 'Ğ¼Ğ¸Ğ½ÑƒÑ‚');
        else form = (value === 1) ? 'ÑĞµĞºÑƒĞ½Ğ´Ğ°' : (value < 5 ? 'ÑĞµĞºÑƒĞ½Ğ´Ñ‹' : 'ÑĞµĞºÑƒĞ½Ğ´');
        return `${value} ${form} ${t.ago}`;
      }
      const plural = value > 1 ? (t.plural || '') : '';
      if(language === 'es' || language === 'fr' || language === 'pt') {
        return `${t.ago} ${value} ${t[unit]}${plural}`;
      }
      return `${value} ${t[unit]}${plural} ${t.ago}`;
    };

    const intervals: { limit: number; unit: Unit }[] = [
      { limit: 31536000, unit: 'year' },
      { limit: 2592000, unit: 'month' },
      { limit: 86400, unit: 'day' },
      { limit: 3600, unit: 'hour' },
      { limit: 60, unit: 'minute' },
    ];

    for (const interval of intervals) {
      const count = Math.floor(seconds / interval.limit);
      if (count >= 1) {
        return format(count, interval.unit);
      }
    }

    return format(seconds, 'second');
  };

  return (
    <div style={{
      border: '1px solid #e0e0e0',
      borderRadius: '12px',
      overflow: 'hidden',
      backgroundColor: 'white',
      boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
      width: '280px',
      height: isExpanded ? '1100px' : '900px',
      display: 'flex',
      flexDirection: 'column',
      transition: 'height 0.3s ease'
    }}>
      {/* ì¸ë„¤ì¼ ì˜ì—­ */}
      <div style={{ position: 'relative', paddingBottom: '56.25%', backgroundColor: '#f0f0f0' }}>
        <img
          src={short.thumbnailUrl}
          alt={short.title}
          style={{
            position: 'absolute',
            top: 0,
            left: 0,
            width: '100%',
            height: '100%',
            objectFit: 'cover'
          }}
        />
        {short.duration && (
          <div style={{
            position: 'absolute',
            bottom: '8px',
            right: '8px',
            backgroundColor: 'rgba(0,0,0,0.8)',
            color: 'white',
            padding: '2px 6px',
            borderRadius: '4px',
            fontSize: '12px',
            fontWeight: 'bold'
          }}>
            {short.duration}
          </div>
        )}
      </div>

      {/* ì½˜í…ì¸  ì˜ì—­ */}
      <div style={{ padding: '16px', flex: 1 }}>
        {/* ì œëª© */}
        <h3 style={{
          margin: '0 0 8px 0',
          fontSize: '16px',
          fontWeight: 'bold',
          lineHeight: '1.3',
          overflow: 'hidden',
          display: '-webkit-box',
          WebkitLineClamp: 2,
          WebkitBoxOrient: 'vertical',
          color: '#323545'
        }}>
          {short.title}
        </h3>

        {/* ì±„ë„ëª… */}
        <p style={{
          margin: '0 0 8px 0',
          color: '#323545',
          fontSize: '14px'
        }}>
          @ {short.channelTitle}
        </p>


        <hr style={{ border: 'none', borderTop: '1px solid #eee', margin: '16px 0' }} />

        {/* ìƒë‹¨ í†µê³„ 3ê°œ ì—´ */}
        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(3, 1fr)',
          gap: '16px',
          marginBottom: '16px',
          textAlign: 'center'
        }}>
          <div>
            <div style={{ fontSize: '12px', color: '#323545', marginBottom: '8px' }}>êµ¬ë…ì</div>
            <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#323545' }}>
              {short.subscriberCount ? formatNumber(short.subscriberCount) : 'N/A'}
            </div>
          </div>
          <div>
            <div style={{ fontSize: '12px', color: '#323545', marginBottom: '8px' }}>ì¡°íšŒìˆ˜</div>
            <div style={{ fontSize: '16px', fontWeight: 'bold', color: 'rgb(124, 58, 237)' }}>
              {formatNumber(short.viewCount)}
            </div>
          </div>
          <div>
            <div style={{ fontSize: '12px', color: '#323545', marginBottom: '8px' }}>ì—…ë¡œë“œ</div>
            <div style={{ fontSize: '16px', fontWeight: 'bold', color: 'rgb(124, 58, 237)' }}>
              {timeAgo(short.publishedAt)}
            </div>
          </div>
        </div>


        {/* ì¢‹ì•„ìš”, ëŒ“ê¸€ 2ê°œ ì—´ */}
        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(2, 1fr)',
          gap: '32px',
          marginBottom: '20px',
          textAlign: 'center'
        }}>
          <div>
            <div style={{ fontSize: '21px', marginBottom: '4px' }}>â¤ï¸</div>
            <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#323545' }}>
              {short.likeCount ? formatNumber(short.likeCount) : 'N/A'}
            </div>
          </div>
          <div>
            <div style={{ fontSize: '20px', marginBottom: '4px' }}>ğŸ’¬</div>
            <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#323545' }}>
              {short.commentCount ? formatNumber(short.commentCount) : 'N/A'}
            </div>
          </div>
        </div>

        <hr style={{ border: 'none', borderTop: '1px solid #eee', margin: '16px 0' }} />

        {/* ë¶„ì„ ì •ë³´ */}
        <div style={{ fontSize: '13px', lineHeight: '1.8', color: '#323545' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
            <span>êµ­ê°€</span>
            <span style={{ fontWeight: 'bold' }}>
              {detectCountryFromTitle()}
            </span>
          </div>
          
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
            <span>ì¹´í…Œê³ ë¦¬</span>
            <span style={{ fontWeight: 'bold' }}>
              {getCategoryName(short.categoryId)}
            </span>
          </div>
          
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
            <span>ì´ ì˜ìƒ</span>
            <span style={{ fontWeight: 'bold' }}>
              {short.videoCount ? formatNumber(short.videoCount) + 'ê°œ' : 'N/A'}
            </span>
          </div>

          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
            <span>ì´ ì¡°íšŒìˆ˜</span>
            <span style={{ fontWeight: 'bold' }}>
              {short.channelViewCount ? formatNumber(short.channelViewCount) : 'N/A'}
            </span>
          </div>

          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
            <span>í‰ê·  ì¡°íšŒìˆ˜</span>
            <span style={{ fontWeight: 'bold', color: 'rgb(124, 58, 237)' }}>
              {averageViews > 0 ? formatNumber(averageViews) : 'N/A'}
            </span>
          </div>

          {/* êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒìˆ˜ - í”„ë¡œê·¸ë ˆìŠ¤ ë°” */}
          {short.viewsPerSubscriber && (
            <div style={{ marginBottom: '16px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
                <span style={{ color: '#323545', fontSize: '13px' }}>êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒìˆ˜</span>
                <span style={{ fontWeight: 'bold', color: 'rgb(124, 58, 237)', fontSize: '13px' }}>
                  {short.viewsPerSubscriber.toFixed(0)}%
                </span>
              </div>
              
              {/* êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒìˆ˜ í”„ë¡œê·¸ë˜ìŠ¤ ë°” */}
              <div style={{
                width: '100%',
                height: '8px',
                backgroundColor: '#e0e0e0',
                borderRadius: '4px',
                overflow: 'hidden'
              }}>
                <div style={{
                  width: `${Math.min((short.viewsPerSubscriber / 10000) * 100, 100)}%`, // 10,000%ë¥¼ ìµœëŒ€ê°’ìœ¼ë¡œ ì„¤ì •
                  height: '100%',
                  backgroundColor: 'rgb(124, 58, 237)',
                  transition: 'width 0.3s ease'
                }} />
              </div>
            </div>
          )}

          {/* ì°¸ì—¬ìœ¨ */}
          <div style={{ marginBottom: '16px' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
              <span>ì°¸ì—¬ìœ¨</span>
              <span style={{ fontWeight: 'bold' }}>{engagementRate.toFixed(2)}%</span>
            </div>
            
            {/* ì°¸ì—¬ìœ¨ í”„ë¡œê·¸ë˜ìŠ¤ ë°” */}
            <div style={{
              width: '100%',
              height: '8px',
              backgroundColor: '#e0e0e0',
              borderRadius: '4px',
              overflow: 'hidden'
            }}>
              <div style={{
                width: `${Math.min((engagementRate / 100) * 100, 100)}%`, // 100%ë¥¼ ìµœëŒ€ë¡œ ìŠ¤ì¼€ì¼ë§
                height: '100%',
                backgroundColor: 'rgb(124, 58, 237)',
                transition: 'width 0.3s ease'
              }} />
            </div>
          </div>
        </div>

        {/* íƒœê·¸ë“¤ */}
        {short.tags && short.tags.length > 0 && (
          <div style={{ marginTop: '16px' }}>
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}>
              {/* íƒœê·¸ í‘œì‹œ ì˜ì—­ */}
              <div style={{
                display: 'flex',
                flexWrap: 'nowrap',
                gap: '6px',
                flex: 1,
                overflow: 'hidden'
              }}>
                {/* ì²˜ìŒ 2ê°œ íƒœê·¸ë§Œ í‘œì‹œ */}
                {short.tags.slice(0, 2).map((tag, idx) => (
                  <span key={idx} style={{
                    backgroundColor: '#f0f0f0',
                    color: '#323545',
                    fontSize: '11px',
                    padding: '4px 8px',
                    borderRadius: '4px',
                    fontWeight: 'normal',
                    whiteSpace: 'nowrap'
                  }}>
                    {tag}
                  </span>
                ))}
                
                {/* [+ ìˆ«ì] ë²„íŠ¼ */}
                {short.tags.length > 2 && (
                  <button
                    onClick={() => {
                      setIsExpanded(!isExpanded);
                      setShowAllTags(!showAllTags);
                    }}
                    style={{
                      backgroundColor: '#f0f0f0',
                      border: 'none',
                      borderRadius: '4px',
                      padding: '4px 8px',
                      fontSize: '11px',
                      color: '#323545',
                      cursor: 'pointer',
                      fontWeight: 'normal',
                      whiteSpace: 'nowrap'
                    }}
                  >
                    {isExpanded ? 'ì ‘ê¸°' : `[+ ${short.tags.length - 2}]`}
                  </button>
                )}
              </div>
              
              {/* ë³µì‚¬ ë²„íŠ¼ */}
              <button
                onClick={() => {
                  const tagsText = short.tags?.join(', ') || '';
                  navigator.clipboard.writeText(tagsText).then(() => {
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                  }).catch(() => {
                    alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                  });
                }}
                style={{
                  backgroundColor: '#fafafa',
                  border: '1px solid #eeeeee',
                  borderRadius: '6px',
                  padding: '6px 8px',
                  cursor: 'pointer',
                  fontSize: '14px',
                  color: '#323545',
                  minWidth: '32px',
                  height: '28px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}
                title="íƒœê·¸ ë³µì‚¬"
              >
                {isCopied ? (
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polyline points="20,6 9,17 4,12"></polyline>
                  </svg>
                ) : (
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                )}
              </button>
            </div>
            
            {/* í™•ì¥ëœ íƒœê·¸ë“¤ */}
            {isExpanded && short.tags.length > 2 && (
              <div style={{
                display: 'flex',
                flexWrap: 'wrap',
                gap: '6px',
                marginTop: '12px',
                padding: '12px',
                backgroundColor: '#f9f9f9',
                borderRadius: '8px'
              }}>
                {short.tags.slice(2).map((tag, idx) => (
                  <span key={idx + 2} style={{
                    backgroundColor: '#f0f0f0',
                    color: '#323545',
                    fontSize: '11px',
                    padding: '4px 8px',
                    borderRadius: '4px',
                    fontWeight: 'normal'
                  }}>
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        )}

        {/* íƒœê·¸ ì•„ë˜ êµ¬ë¶„ì„  */}
        <hr style={{ border: 'none', borderTop: '1px solid #eee', margin: '16px 0' }} />
      </div>
    </div>
  );
};

export default ShortsCardNew;