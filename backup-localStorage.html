<!DOCTYPE html>
<html>
<head>
    <title>Emergency localStorage Backup</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        textarea { width: 100%; height: 300px; font-family: monospace; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸš¨ Emergency localStorage Backup</h1>
    <p>ì´ í˜ì´ì§€ëŠ” localStorageì— ìˆëŠ” ëª¨ë“  ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ê³  ë³µì›í•˜ëŠ” ìš©ë„ì…ë‹ˆë‹¤.</p>
    
    <div>
        <button onclick="backupLocalStorage()">ğŸ“¥ localStorage ë°±ì—…</button>
        <button onclick="downloadBackup()">ğŸ’¾ ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
        <button onclick="clearDisplay()">ğŸ—‘ï¸ í™”ë©´ ì§€ìš°ê¸°</button>
    </div>
    
    <div id="status"></div>
    <textarea id="backupData" placeholder="ë°±ì—…ëœ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
    
    <div>
        <input type="file" id="restoreFile" accept=".json" style="margin: 10px 0;">
        <button onclick="restoreFromFile()">ğŸ“¤ íŒŒì¼ì—ì„œ ë³µì›</button>
    </div>

    <script>
        let backupData = null;
        
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.innerHTML = `<p class="${isError ? 'error' : 'success'}">${message}</p>`;
            setTimeout(() => status.innerHTML = '', 3000);
        }
        
        function backupLocalStorage() {
            try {
                const backup = {};
                const articles = [];
                const thumbnails = {};
                
                // Get all localStorage data
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    
                    if (key.startsWith('article_') || key === 'published_articles' || key.startsWith('thumbnail_')) {
                        backup[key] = value;
                        
                        if (key.startsWith('article_')) {
                            try {
                                articles.push(JSON.parse(value));
                            } catch (e) {
                                console.error('Error parsing article:', key, e);
                            }
                        }
                    }
                }
                
                backupData = {
                    timestamp: new Date().toISOString(),
                    localStorage: backup,
                    summary: {
                        totalKeys: Object.keys(backup).length,
                        articleCount: articles.length,
                        thumbnailCount: Object.keys(backup).filter(k => k.startsWith('thumbnail_')).length
                    }
                };
                
                document.getElementById('backupData').value = JSON.stringify(backupData, null, 2);
                showStatus(`âœ… ë°±ì—… ì™„ë£Œ! ${backupData.summary.articleCount}ê°œ ê¸°ì‚¬, ${backupData.summary.thumbnailCount}ê°œ ì¸ë„¤ì¼`);
                
            } catch (error) {
                showStatus(`âŒ ë°±ì—… ì‹¤íŒ¨: ${error.message}`, true);
            }
        }
        
        function downloadBackup() {
            if (!backupData) {
                showStatus('âŒ ë¨¼ì € ë°±ì—…ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”!', true);
                return;
            }
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vidhunt-news-backup-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('âœ… ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function restoreFromFile() {
            const file = document.getElementById('restoreFile').files[0];
            if (!file) {
                showStatus('âŒ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', true);
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.localStorage) {
                        Object.keys(data.localStorage).forEach(key => {
                            localStorage.setItem(key, data.localStorage[key]);
                        });
                        
                        showStatus(`âœ… ë³µì› ì™„ë£Œ! ${Object.keys(data.localStorage).length}ê°œ í•­ëª© ë³µì›ë¨`);
                    } else {
                        showStatus('âŒ ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤!', true);
                    }
                } catch (error) {
                    showStatus(`âŒ ë³µì› ì‹¤íŒ¨: ${error.message}`, true);
                }
            };
            reader.readAsText(file);
        }
        
        function clearDisplay() {
            document.getElementById('backupData').value = '';
            document.getElementById('status').innerHTML = '';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ í˜„ì¬ ìƒíƒœ í™•ì¸
        window.onload = function() {
            const articleCount = Object.keys(localStorage).filter(k => k.startsWith('article_')).length;
            const thumbnailCount = Object.keys(localStorage).filter(k => k.startsWith('thumbnail_')).length;
            
            if (articleCount > 0) {
                showStatus(`ğŸ“Š í˜„ì¬ localStorage: ${articleCount}ê°œ ê¸°ì‚¬, ${thumbnailCount}ê°œ ì¸ë„¤ì¼ ë°œê²¬`);
            } else {
                showStatus('âš ï¸ localStorageì— ë‰´ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', true);
            }
        };
    </script>
</body>
</html>